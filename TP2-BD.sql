-- MySQL Script generated by MySQL Workbench
-- Fri Nov 14 22:10:12 2025
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

-- -----------------------------------------------------
-- Schema mydb
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema mydb
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `trabalhobd` DEFAULT CHARACTER SET utf8 ;
USE `trabalhobd` ;

-- -----------------------------------------------------
-- Table `trabalhobd`.`fabricante`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `trabalhobd`.`fabricante` (
  `idfabricante` INT NOT NULL,
  `nomefab` VARCHAR(30) NULL,
  `ano_fundacao` INT NULL,
  PRIMARY KEY (`idfabricante`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `trabalhobd`.`plataforma`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `trabalhobd`.`plataforma` (
  `idPlataforma` INT NOT NULL,
  `nomeplat` VARCHAR(30) NULL,
  `ano_lancamento` INT NULL,
  `memoria` INT NULL,
  `idfabricante` INT NOT NULL,
  PRIMARY KEY (`idPlataforma`),
  INDEX `fk_plataforma_fabricante1_idx` (`idfabricante` ASC) VISIBLE,
  CONSTRAINT `fk_plataforma_fabricante1`
    FOREIGN KEY (`idfabricante`)
    REFERENCES `trabalhobd`.`fabricante` (`idfabricante`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `trabalhobd`.`midia`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `trabalhobd`.`midia` (
  `idmidia` INT NOT NULL,
  `nomemid` VARCHAR(30) NULL,
  `velocidade_leitura` INT NULL,
  PRIMARY KEY (`idmidia`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `trabalhobd`.`jogo`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `trabalhobd`.`jogo` (
  `idjogo` INT NOT NULL,
  `nomejogo` VARCHAR(30) NULL,
  `descricao` VARCHAR(30) NULL,
  PRIMARY KEY (`idjogo`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `trabalhobd`.`compativel_midia`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `trabalhobd`.`compativel_midia` (
  `idPlataforma` INT NOT NULL,
  `idmidia` INT NOT NULL,
  PRIMARY KEY (`idPlataforma`, `idmidia`),
  INDEX `fk_Plataforma_has_midia_midia1_idx` (`idmidia` ASC) VISIBLE,
  INDEX `fk_Plataforma_has_midia_Plataforma_idx` (`idPlataforma` ASC) VISIBLE,
  CONSTRAINT `fk_Plataforma_has_midia_Plataforma`
    FOREIGN KEY (`idPlataforma`)
    REFERENCES `trabalhobd`.`plataforma` (`idPlataforma`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_Plataforma_has_midia_midia1`
    FOREIGN KEY (`idmidia`)
    REFERENCES `trabalhobd`.`midia` (`idmidia`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `trabalhobd`.`compativel_jogo_plataforma`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `trabalhobd`.`compativel_jogo_plataforma` (
  `idPlataforma` INT NOT NULL,
  `idjogo` INT NOT NULL,
  `quantidade` INT NULL,
  `ano_lancamento_jogo` INT NULL,
  PRIMARY KEY (`idPlataforma`, `idjogo`),
  INDEX `fk_Plataforma_has_jogo_jogo1_idx` (`idjogo` ASC) VISIBLE,
  INDEX `fk_Plataforma_has_jogo_Plataforma1_idx` (`idPlataforma` ASC) VISIBLE,
  CONSTRAINT `fk_Plataforma_has_jogo_Plataforma1`
    FOREIGN KEY (`idPlataforma`)
    REFERENCES `trabalhobd`.`plataforma` (`idPlataforma`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_Plataforma_has_jogo_jogo1`
    FOREIGN KEY (`idjogo`)
    REFERENCES `trabalhobd`.`jogo` (`idjogo`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;

-- DADOS INSERIDOS

INSERT INTO `trabalhobd`.`fabricante` (`idfabricante`, `nomefab`, `ano_fundacao`) VALUES (1, 'Nintendo', 1889);
INSERT INTO `trabalhobd`.`fabricante` (`idfabricante`, `nomefab`, `ano_fundacao`) VALUES (2, 'Sony', 1946);
INSERT INTO `trabalhobd`.`fabricante` (`idfabricante`, `nomefab`, `ano_fundacao`) VALUES (3, 'Microsoft', 1975);
INSERT INTO `trabalhobd`.`fabricante` (`idfabricante`, `nomefab`, `ano_fundacao`) VALUES (4, 'Atari', 1972);


INSERT INTO `trabalhobd`.`plataforma` (`idplataforma`, `nomeplat`, `ano_lancamento`, `memoria`, `idfabricante`) VALUES (1, 'Atari 2600', 1977, '128', 4);
INSERT INTO `trabalhobd`.`plataforma` (`idplataforma`, `nomeplat`, `ano_lancamento`, `memoria`, `idfabricante`) VALUES (2, 'NES', 1985, '2048', 1);
INSERT INTO `trabalhobd`.`plataforma` (`idplataforma`, `nomeplat`, `ano_lancamento`, `memoria`, `idfabricante`) VALUES (3, 'SNES', 1990, '131072', 1);
INSERT INTO `trabalhobd`.`plataforma` (`idplataforma`, `nomeplat`, `ano_lancamento`, `memoria`, `idfabricante`) VALUES (4, 'Wii', 2006, '92274688', 1);
INSERT INTO `trabalhobd`.`plataforma` (`idplataforma`, `nomeplat`, `ano_lancamento`, `memoria`, `idfabricante`) VALUES (5, 'Xbox360', 2005, '536870912', 3);
INSERT INTO `trabalhobd`.`plataforma` (`idplataforma`, `nomeplat`, `ano_lancamento`, `memoria`, `idfabricante`) VALUES (6, 'PlayStation3', 2006, '536870912', 2);


INSERT INTO `trabalhobd`.`midia` (`idmidia`, `nomemid`, `velocidade_leitura`) VALUES (1, 'CD', 10);
INSERT INTO `trabalhobd`.`midia` (`idmidia`, `nomemid`, `velocidade_leitura`) VALUES (2, 'DVD', 20);
INSERT INTO `trabalhobd`.`midia` (`idmidia`, `nomemid`, `velocidade_leitura`) VALUES (3, 'Blu-ray', 40);
INSERT INTO `trabalhobd`.`midia` (`idmidia`, `nomemid`, `velocidade_leitura`) VALUES (4, 'Disquete', 1);
INSERT INTO `trabalhobd`.`midia` (`idmidia`, `nomemid`, `velocidade_leitura`) VALUES (5, 'SD', 100);
INSERT INTO `trabalhobd`.`midia` (`idmidia`, `nomemid`, `velocidade_leitura`) VALUES (6, 'Cartucho', 1000);
INSERT INTO `trabalhobd`.`midia` (`idmidia`, `nomemid`, `velocidade_leitura`) VALUES (7, 'HD-USB', 100);


INSERT INTO `trabalhobd`.`jogo` (`idjogo`, `nomejogo`, `descricao`) VALUES (1, 'River Raid', 'Tiro');
INSERT INTO `trabalhobd`.`jogo` (`idjogo`, `nomejogo`, `descricao`) VALUES (2, 'Mario Bros', 'Aventura');
INSERT INTO `trabalhobd`.`jogo` (`idjogo`, `nomejogo`, `descricao`) VALUES (3, 'F-Zero', 'Corrida');
INSERT INTO `trabalhobd`.`jogo` (`idjogo`, `nomejogo`, `descricao`) VALUES (4, 'Super Mario Bros', 'Aventura');
INSERT INTO `trabalhobd`.`jogo` (`idjogo`, `nomejogo`, `descricao`) VALUES (5, 'Wii Sports', 'Esportes variados');
INSERT INTO `trabalhobd`.`jogo` (`idjogo`, `nomejogo`, `descricao`) VALUES (6, 'FIFA12', 'Futebol');
INSERT INTO `trabalhobd`.`jogo` (`idjogo`, `nomejogo`, `descricao`) VALUES (7, 'God of War 3', 'Ação');
INSERT INTO `trabalhobd`.`jogo` (`idjogo`, `nomejogo`, `descricao`) VALUES (8, 'Forza MotorSport', 'Corrida realista');
INSERT INTO `trabalhobd`.`jogo` (`idjogo`, `nomejogo`, `descricao`) VALUES (9, 'Gran Turismo 5', 'Corrida realista');
INSERT INTO `trabalhobd`.`jogo` (`idjogo`, `nomejogo`, `descricao`) VALUES (10, 'Street Fighter IV', 'Luta');


INSERT INTO `trabalhobd`.`compativel_midia` (`idplataforma`, `idmidia`) VALUES (1, 6);
INSERT INTO `trabalhobd`.`compativel_midia` (`idplataforma`, `idmidia`) VALUES (2, 4);
INSERT INTO `trabalhobd`.`compativel_midia` (`idplataforma`, `idmidia`) VALUES (2, 6);
INSERT INTO `trabalhobd`.`compativel_midia` (`idplataforma`, `idmidia`) VALUES (3, 6);
INSERT INTO `trabalhobd`.`compativel_midia` (`idplataforma`, `idmidia`) VALUES (4, 2);
INSERT INTO `trabalhobd`.`compativel_midia` (`idplataforma`, `idmidia`) VALUES (4, 5);
INSERT INTO `trabalhobd`.`compativel_midia` (`idplataforma`, `idmidia`) VALUES (5, 2);
INSERT INTO `trabalhobd`.`compativel_midia` (`idplataforma`, `idmidia`) VALUES (5, 7);
INSERT INTO `trabalhobd`.`compativel_midia` (`idplataforma`, `idmidia`) VALUES (6, 3);
INSERT INTO `trabalhobd`.`compativel_midia` (`idplataforma`, `idmidia`) VALUES (6, 7);



INSERT INTO `trabalhobd`.`compativel_jogo_plataforma` (`idplataforma`, `idjogo`, `quantidade`, `ano_lancamento_jogo`) VALUES (1, 1, 2, 1982);
INSERT INTO `trabalhobd`.`compativel_jogo_plataforma` (`idplataforma`, `idjogo`, `quantidade`, `ano_lancamento_jogo`) VALUES (1, 2, 2, 1983);
INSERT INTO `trabalhobd`.`compativel_jogo_plataforma` (`idplataforma`, `idjogo`, `quantidade`, `ano_lancamento_jogo`) VALUES (2, 2, 1, 1983);
INSERT INTO `trabalhobd`.`compativel_jogo_plataforma` (`idplataforma`, `idjogo`, `quantidade`, `ano_lancamento_jogo`) VALUES (3, 3, 1, 1990);
INSERT INTO `trabalhobd`.`compativel_jogo_plataforma` (`idplataforma`, `idjogo`, `quantidade`, `ano_lancamento_jogo`) VALUES (4, 3, 1, 2007);
INSERT INTO `trabalhobd`.`compativel_jogo_plataforma` (`idplataforma`, `idjogo`, `quantidade`, `ano_lancamento_jogo`) VALUES (2, 4, 1, 1985);
INSERT INTO `trabalhobd`.`compativel_jogo_plataforma` (`idplataforma`, `idjogo`, `quantidade`, `ano_lancamento_jogo`) VALUES (4, 4, 1, 2007);
INSERT INTO `trabalhobd`.`compativel_jogo_plataforma` (`idplataforma`, `idjogo`, `quantidade`, `ano_lancamento_jogo`) VALUES (4, 5, 1, 2006);
INSERT INTO `trabalhobd`.`compativel_jogo_plataforma` (`idplataforma`, `idjogo`, `quantidade`, `ano_lancamento_jogo`) VALUES (4, 6, 1, 2011);
INSERT INTO `trabalhobd`.`compativel_jogo_plataforma` (`idplataforma`, `idjogo`, `quantidade`, `ano_lancamento_jogo`) VALUES (5, 6, 1, 2011);
INSERT INTO `trabalhobd`.`compativel_jogo_plataforma` (`idplataforma`, `idjogo`, `quantidade`, `ano_lancamento_jogo`) VALUES (6, 6, 1, 2011);
INSERT INTO `trabalhobd`.`compativel_jogo_plataforma` (`idplataforma`, `idjogo`, `quantidade`, `ano_lancamento_jogo`) VALUES (6, 7, 2, 2012);
INSERT INTO `trabalhobd`.`compativel_jogo_plataforma` (`idplataforma`, `idjogo`, `quantidade`, `ano_lancamento_jogo`) VALUES (5, 8, 1, 2011);
INSERT INTO `trabalhobd`.`compativel_jogo_plataforma` (`idplataforma`, `idjogo`, `quantidade`, `ano_lancamento_jogo`) VALUES (6, 9, 1, 2010);
INSERT INTO `trabalhobd`.`compativel_jogo_plataforma` (`idplataforma`, `idjogo`, `quantidade`, `ano_lancamento_jogo`) VALUES (5, 10, 2, 2008);
INSERT INTO `trabalhobd`.`compativel_jogo_plataforma` (`idplataforma`, `idjogo`, `quantidade`, `ano_lancamento_jogo`) VALUES (6, 10, 1, 2008);

-- consultas

SELECT DISTINCT p.nomeplat
FROM plataforma AS p
NATURAL JOIN compativel_midia AS cm
NATURAL JOIN midia AS m
WHERE m.velocidade_leitura > 100;

SELECT p.nomeplat, p.ano_lancamento
FROM plataforma AS p
NATURAL JOIN fabricante AS f
WHERE f.ano_fundacao > 1970;

SELECT  m.nomemid, m.velocidade_leitura
FROM midia AS m
WHERE m.velocidade_leitura >= 10 AND m.velocidade_leitura <= 30
ORDER BY m.velocidade_leitura DESC, m.nomemid ASC;

INSERT INTO `trabalhobd`.`plataforma`
(idplataforma, nomeplat, ano_lancamento, memoria, idfabricante)
VALUES (
    7,
    'WiiU',
    2012,
    2147483648,
    (SELECT idfabricante
     FROM fabricante
     WHERE nomefab = 'Nintendo')
);

SELECT p.nomeplat AS plataforma, f.nomefab AS fabricante, SUM(cjp.quantidade) AS numero_jogos
FROM plataforma p
JOIN fabricante f ON p.idfabricante = f.idfabricante
LEFT JOIN compativel_jogo_plataforma cjp ON p.idPlataforma = cjp.idPlataforma
GROUP BY p.idPlataforma, p.nomeplat, f.nomefab
ORDER BY p.nomeplat ASC;

SELECT j.nomejogo
FROM jogo AS j NATURAL JOIN compativel_jogo_plataforma AS cjp
GROUP BY j.idjogo
HAVING COUNT(cjp.idplataforma) >= 2;

SELECT cjp.ano_lancamento_jogo, COUNT(*) AS jogos_lancados
FROM compativel_jogo_plataforma AS cjp
GROUP BY cjp.ano_lancamento_jogo
ORDER BY cjp.ano_lancamento_jogo ASC;

SELECT  j.nomejogo,  cjp.ano_lancamento_jogo
FROM compativel_jogo_plataforma AS cjp NATURAL JOIN jogo AS j
ORDER BY cjp.ano_lancamento_jogo ASC
LIMIT 1;

SELECT AVG(p.memoria)
FROM  plataforma AS p NATURAL JOIN compativel_jogo_plataforma AS cjp
WHERE cjp.quantidade > 0;

SELECT f.nomefab
FROM fabricante AS f NATURAL JOIN plataforma AS p NATURAL JOIN midia AS m
GROUP BY idfabricante
HAVING COUNT(DISTINCT m.idmidia) > 1
ORDER BY f.nomefab;

-- TABELAS CRIADAS
CREATE TABLE fabricante_midia (
    idmidia INT NOT NULL,         
    idfabricante INT NOT NULL,    
    
    PRIMARY KEY (idmidia, idfabricante),
    
    
    FOREIGN KEY (idmidia) 
        REFERENCES midia(idmidia)
        ON DELETE CASCADE 
        ON UPDATE CASCADE,
        
    FOREIGN KEY (idfabricante) 
        REFERENCES fabricante(idfabricante)
        ON DELETE CASCADE 
        ON UPDATE CASCADE
);

ALTER TABLE fabricante_midia
ADD COLUMN ano_lancamento_midia INT;


INSERT INTO fabricante_midia (idmidia, idfabricante, ano_lancamento_midia) VALUES
(1, 1, 2020),
(1, 3, 2021),

(2, 1, 2020),
(2, 2, 2023),
(2, 4, 2024),

(3, 3, 2019),

(4, 2, 2022),
(4, 4, 2024),

(5, 1, 2025),

(6, 3, 2021),

(7, 4, 2023);

SELECT *
FROM fabricante_midia;

CREATE TABLE controle (
    idcontrole INT NOT NULL,
    idplataforma INT NOT NULL,
    idfabricante INT NOT NULL,
    nomecontrole VARCHAR(35),
    descricao_controle VARCHAR(35) NULL,
    
    PRIMARY KEY (idcontrole),
    
    FOREIGN KEY (idplataforma)
        REFERENCES plataforma(idplataforma)
        ON DELETE CASCADE
        ON UPDATE CASCADE,
        
    FOREIGN KEY (idfabricante)
        REFERENCES fabricante(idfabricante)
        ON DELETE CASCADE
        ON UPDATE CASCADE
);

INSERT INTO controle (idcontrole, idplataforma, idfabricante, nomecontrole) VALUES
(1, 2, 1, 'NES controller'),
(2, 3, 1, 'SNES controller'),
(3, 4, 1, 'Wii Remote'),
(4, 6, 2, 'Dualshock 3'),
(5, 5, 3, 'Xbox Wireless Controller'),
(6, 1, 4, 'Atari 2600 controller');

UPDATE controle 
SET descricao_controle = 'D-pad, A, B, Start, Select' 
WHERE idcontrole = 1;

UPDATE controle 
SET descricao_controle = 'Adiciona X, Y e botões L/R (ombro)' 
WHERE idcontrole = 2;

UPDATE controle 
SET descricao_controle = 'Sensor de movimento e ponteiro IR' 
WHERE idcontrole = 3;

UPDATE controle 
SET descricao_controle = 'Vibração (rumble) e analógicos' 
WHERE idcontrole = 4;

UPDATE controle 
SET descricao_controle = 'Padrão do 360, botões A,B,X,Y' 
WHERE idcontrole = 5;

UPDATE controle 
SET descricao_controle = 'Joystick clássico com um botão' 
WHERE idcontrole = 6;

SELECT *
FROM controle;

-- Q13(1) -- Liste o nome, plataforma e fabricante dos controller que possuem "controller" 
-- em seu nome, considere case insensitive
SELECT  c.nomecontrole AS nome_do_controle, p.nomeplat AS plataforma, f.nomefab AS fabricante, 
c.descricao_controle AS descricao
FROM controle AS c NATURAL JOIN plataforma AS p
NATURAL JOIN  fabricante AS f
WHERE c.nomecontrole LIKE '%controller%';

-- Q13(2) -- Liste o nome da fabricante e o nome da mídia na qual a plataforma e a midia possuem 
-- o mesmo fabricante entre si
SELECT DISTINCT f_plat.nomefab AS fabricante, m.nomemid AS nome_da_midia
FROM  fabricante AS f_plat NATURAL JOIN plataforma AS p
NATURAL JOIN  compativel_midia AS cm
NATURAL JOIN  midia AS m
NATURAL JOIN fabricante_midia AS fm
NATURAL JOIN fabricante AS f_midia
WHERE f_plat.nomefab = f_midia.nomefab;




